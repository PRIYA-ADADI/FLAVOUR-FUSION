import streamlit as st
import google.generativeai as genai
import random

# --- PAGE CONFIGURATION ---
st.set_page_config(page_title="RecepieMaster", page_icon="üç≥")

# --- ACTIVITY 2.2: CONFIGURE API KEY ---
# NOTE: Replace "YOUR_API_KEY_HERE" with your actual Google API Key
api_key = "AIzaSyBhTWzzCH6Q3NLIU0tfkYNB_8mxHhYoinA" 
genai.configure(api_key=api_key)

# --- ACTIVITY 2.3: MODEL CONFIGURATION ---
generation_config = {
    "temperature": 0.75,
    "top_p": 0.95,
    "top_k": 64,
    "max_output_tokens": 8192,
    "response_mime_type": "text/plain",
}
# Initialize the Model (Gemini 1.5 Flash)
model = genai.GenerativeModel(
    model_name="gemini-2.5-flash",
    generation_config=generation_config,
)

# --- MILESTONE 3: JOKE GENERATION FUNCTION ---
def get_joke():
    jokes = [
        "Why don't programmers like nature? It has too many bugs.",
        "Why do Java developers wear glasses? Because they don't see sharp.",
        "Why was the JavaScript developer sad? Because he didn't know how to 'null' his feelings.",
        "Why don't programmers like nature? It has too many bugs.",
        "Why do programmers prefer dark mode? Because light attracts bugs!",
        "Why do Java developers wear glasses? Because they don't see sharp.",
        "Why was the JavaScript developer sad? Because he didn't know how to 'null' his feelings.",
        "Why do Python programmers prefer using snake_case? Because it's easier to read!",
        "How many programmers does it take to change a light bulb? None, that's a hardware problem.",
        "Why did the developer go broke? Because he used up all his cache.",
        "Why do programmers always mix up Christmas and Halloween? Because Oct 31 == Dec 25.",
        "Why did the programmer get kicked out of the beach? Because he kept using the 'C' language!",
        "Why was the computer cold? It left its Windows open."
    ]
    return random.choice(jokes)

# --- MILESTONE 4: RECIPE GENERATION FUNCTION ---
def recepie_generation(user_input, word_count):
    """
    Function to generate a blog based on user input and word count.
    """
    st.write("### üïí Generating your recepie...")
    st.write(f"While I work on creating your blog, here's a little joke to keep you entertained:\n\n**{get_joke()}**")

    chat_session = model.start_chat(
        history=[
            {
                "role": "user",
                "parts": [
                    f"Write a recepie based on the input topic: {user_input} and number of words: {word_count}\n",
                ],
            },
        ]
    )

    try:
        response = chat_session.send_message(user_input)
        st.success("üéâ Your recepie is ready!")
        return response.text
    except Exception as e:
        st.error(f"Error generating blog: {e}")
        return None

# --- MAIN UI LAYOUT ---
st.markdown("<h1>RecepieMaster: AI-Powered Blog Generation</h1>", unsafe_allow_html=True)
st.write("ü§ñ Hello! I'm recepieMaster, your friendly robot. Let's create a fantastic recepie together! üîó")

topic = st.text_input("Topic", placeholder="e.g., malai kofta")
word_count = st.number_input("Number of words", min_value=100, max_value=2000, value=555, step=1)

if st.button("Generate recepie"):
    if topic:
        result = recepie_generation(topic, word_count)
        if result:
            st.markdown("---")
            st.markdown(result)
    else:
        st.warning("Please enter a topic first!")